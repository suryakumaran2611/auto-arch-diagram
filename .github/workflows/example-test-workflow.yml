name: Example Test Workflow

on:
  pull_request:
    branches: [ main, develop ]
    paths:
      - '**.py'
      - 'requirements*.txt'
      - 'tests/**'
      - 'tools/**'
  push:
    branches: [ main ]
    paths:
      - '**.py'
      - 'requirements*.txt'
      - 'tests/**'
      - 'tools/**'
  workflow_dispatch:

permissions:
  contents: read
  actions: read
  pull-requests: write
  security-events: write

jobs:
  call-testing-workflow:
    uses: ./.github/workflows/reusable-testing.yml
    with:
      python-version: '3.12'
      run-security-scans: true
      test-path: 'tests/'
      requirements-files: 'requirements.txt,requirements-dev.txt'
    secrets: inherit

  additional-checks:
    runs-on: ubuntu-latest
    needs: call-testing-workflow
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'
          cache-dependency-path: |
            requirements.txt
            requirements-dev.txt

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install -r requirements-dev.txt

      - name: Validate configuration files
        run: |
          # Validate YAML files
          python -c "import yaml; yaml.safe_load(open('.auto-arch-diagram.yml'))"
          python -c "import yaml; yaml.safe_load(open('action.yml'))" || echo "action.yml validation failed"

      - name: Check documentation
        run: |
          # Basic documentation checks
          if [ ! -f "README.md" ]; then
            echo "README.md is missing"
            exit 1
          fi