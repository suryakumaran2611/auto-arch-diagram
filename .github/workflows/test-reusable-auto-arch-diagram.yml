name: Test Reusable Architecture Diagram Workflow

on:
  workflow_dispatch:

jobs:
  test-reusable-diagram:
    uses: ./.github/workflows/reusable-auto-arch-diagram.yml
    with:
      changed_files: ''
      iac_globs: |
        examples/serverless-website/aws/cdk/**/*.ts
        examples/serverless-website/aws/cloudformation/**/*.yaml
        examples/serverless-website/aws/terraform/**/*.tf
      out_dir: test-output
      image_formats: png,svg
      mode: static
      direction: AUTO
      render_layout: lanes
      render_bg: transparent
      edge_color: "#4B5563"
      edge_penwidth: "1.3"
      edge_arrowsize: "0.8"
    secrets: inherit
  validate-artifacts:
    runs-on: ubuntu-latest
    needs: test-reusable-diagram
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: List output files
        run: |
          ls -l test-output
      - name: Check for diagram files
        run: |
          test -f test-output/architecture-diagram.png
          test -f test-output/architecture-diagram.svg
      - name: Print success message
        run: echo "Reusable workflow test passed: output diagrams found."
